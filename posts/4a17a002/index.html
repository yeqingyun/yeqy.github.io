<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>用javascript开发一个俄罗斯方块 | 一些</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  
    <meta name="keywords" content="javascript游戏算法" />
  
  
  
    <meta name="baidu-site-verification" content="6MQccnuuGT" />
  
  
  <meta name="description" content="开发游戏不仅能学习算法，也能锻炼人的思维逻辑，提高我们的编程能力，充实我们的问题思考能力和问题解决思路。俄罗斯方块想必大家都玩过，他的游戏逻辑并不复杂，今天我们就来用大家都熟悉的javascript开发一款俄罗斯方块，后续我会写出更多关于游戏开发的文章。">
<meta name="keywords" content="javascript,游戏,算法">
<meta property="og:type" content="article">
<meta property="og:title" content="用javascript开发一个俄罗斯方块">
<meta property="og:url" content="http://ilovejava.cn/posts/4a17a002/index.html">
<meta property="og:site_name" content="一些">
<meta property="og:description" content="开发游戏不仅能学习算法，也能锻炼人的思维逻辑，提高我们的编程能力，充实我们的问题思考能力和问题解决思路。俄罗斯方块想必大家都玩过，他的游戏逻辑并不复杂，今天我们就来用大家都熟悉的javascript开发一款俄罗斯方块，后续我会写出更多关于游戏开发的文章。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-09-11T01:08:49.907Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用javascript开发一个俄罗斯方块">
<meta name="twitter:description" content="开发游戏不仅能学习算法，也能锻炼人的思维逻辑，提高我们的编程能力，充实我们的问题思考能力和问题解决思路。俄罗斯方块想必大家都玩过，他的游戏逻辑并不复杂，今天我们就来用大家都熟悉的javascript开发一款俄罗斯方块，后续我会写出更多关于游戏开发的文章。">
  
    <link rel="alternate" href="/atom.xml" title="一些" type="application/atom+xml" />
  
  <link rel="icon" href="/favicon.ico" />
  
    <link href="/css/font.css" rel="stylesheet" type="text/css" />
  
  <link href="/css/font5.css" rel="stylesheet" type="text/css" />
  <link href="/css/font4.css" rel="stylesheet" type="text/css" />
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" />
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="/css/font2.css" type="text/css" media="all" />

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="/css/font3.css" type="text/css" media="all" />
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/nprogress.css">
  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" />
  <link rel="stylesheet" href="/css/fashion.css" />
  <link rel="stylesheet" href="/css/glyphs.css" />

</head>


</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  
  <div class="site-header-image">
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
  </div>




<header id="allheader" class="site-header" role="banner" 
   style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);"  >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="一些" rel="home"> 一些 </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      
                        <li data="index" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                         
                    
                      
                         <li data="/archives" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                         
                    
                      
                         <li data="/categories" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">分类</a> </li>
                         
                    
                      
                         <li data="/tags" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">标签</a> </li>
                         
                    
                      
                         <li data="/about" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                         
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-用javascript开发一个俄罗斯方块" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      用javascript开发一个俄罗斯方块
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/posts/4a17a002/" class="article-date">
	  <time datetime="2016-01-09T05:36:43.000Z" itemprop="datePublished">一月 9, 2016</time>
	</a>

       
      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>开发游戏不仅能学习算法，也能锻炼人的思维逻辑，提高我们的编程能力，充实我们的问题思考能力和问题解决思路。俄罗斯方块想必大家都玩过，他的游戏逻辑并不复杂，今天我们就来用大家都熟悉的javascript开发一款俄罗斯方块，后续我会写出更多关于游戏开发的文章。</p>
<a id="more"></a>
<h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>es5 + webpack </p>
<p>本文重点在讲解俄罗斯方块游戏的逻辑，如果不了解webpack的话可以去<a href="https://doc.webpack-china.org/" target="_blank" rel="external">webpack</a>官网查看相关文档，在这里我们不就不赘述了。代码中主要用到都是包括es5之前的语法以及api，因为这样可以让不了解es6和es7的同学也能看懂。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p><a href="https://github.com/yeqingyun/Square" target="_blank" rel="external">源码</a>在我的github仓库中，大家可以看一看，代码重点在实现游戏逻辑，大家可以根据自己的需求进行优化。</p>
<h3 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h3><p><a href="../../projects/games/square_1/index.html">俄罗斯方块</a>  </p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>好了，开始解释代码吧，由于代码细节较多，在此我只说明一下重要的部分和总的思路。  </p>
<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Square<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"local_game"</span> <span class="attr">class</span>=<span class="string">"game"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"local_gameover"</span> <span class="attr">class</span>=<span class="string">"gameover"</span>&gt;</span>游戏结束<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"local_next"</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>已用时:<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"local_time"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>已得分:<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"local_score"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btnWarp"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span> <span class="attr">id</span>=<span class="string">"local_start"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btnWarp"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span> <span class="attr">id</span>=<span class="string">"local_pause"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btnWarp"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span> <span class="attr">id</span>=<span class="string">"local_stop"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>结束<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"introduce"</span>&gt;</span></div><div class="line">            操作说明：</div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>↑：变换 ↓：下落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>←：左移 →：右移<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>空格：坠落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这是主页的html代码，俄罗斯方块的所有操作都在这个页面完成，我们的代码也只有这一个html页面。<code>local\_game</code>是显示我们游戏中操作方块的区域，<code>loacl\_gamover</code>是显示游戏结束的隐藏区域，<code>local_next</code>是显示下一个方块的区域。之所以有一个前缀loacl是因为这个游戏后续将会加上与服务器的交互逻辑，这个将在以下篇文章提到，现在可以省略。<br>接下来是业务的实现代码，我们的js分几个模块，下面将解释每个模块的作用</p>
<h4 id="game-js"><a href="#game-js" class="headerlink" title="game.js"></a>game.js</h4><p>game.js主要是控制方块的数据变化，dom节点的操作。  </p>
<pre><code class="javascript"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;
<span class="keyword">import</span> Square <span class="keyword">from</span> <span class="string">"./square.js"</span>;
<span class="keyword">import</span> SquareFactory <span class="keyword">from</span> <span class="string">"./squareFactory.js"</span>;

<span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    <span class="keyword">var</span> gameData = [
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
    ]

    <span class="keyword">var</span> dataClass = [
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
    ]



    <span class="keyword">var</span> cur, next
    <span class="keyword">var</span> gameContainers, nextContainers, timeDiv, gameoverDiv, scoreDiv
    <span class="keyword">var</span> gameDivs = [], nextDivs = []
    <span class="comment">//初始化容器</span>
    <span class="keyword">var</span> initDiv = <span class="function"><span class="keyword">function</span> (<span class="params">data, container, divs</span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) {
            <span class="keyword">var</span> gameDiv = []
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data[<span class="number">0</span>].length; j++) {
                <span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)
                newNode.className = <span class="string">'none'</span>
                container.appendChild(newNode)
                gameDiv.push(newNode)
            }
            <span class="built_in">Array</span>.prototype.push.call(divs, gameDiv)
        }
    }
    <span class="comment">//刷新容器显示</span>
    <span class="keyword">var</span> flushDiv = <span class="function"><span class="keyword">function</span> (<span class="params">data, divs, classes</span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (data[i][j] == <span class="number">0</span>) {
                    divs[i][j].className = <span class="string">'none'</span>
                } <span class="keyword">else</span> {
                    <span class="keyword">if</span> (!classes[i][j])
                        classes[i][j] = <span class="string">'A'</span>
                    divs[i][j].className = classes[i][j]
                }
            }
        }
    }
    <span class="comment">//检测点是否合法</span>
    <span class="keyword">var</span> checkPonit = <span class="function"><span class="keyword">function</span> (<span class="params">pox, x, y</span>) </span>{
        <span class="keyword">if</span> (pox.x + x &lt; <span class="number">0</span>) {
            <span class="keyword">return</span> <span class="literal">false</span>
        } <span class="keyword">else</span> <span class="keyword">if</span> (pox.x + x &gt;= gameData.length) {
            <span class="keyword">return</span> <span class="literal">false</span>
        } <span class="keyword">else</span> <span class="keyword">if</span> (pox.y + y &lt; <span class="number">0</span>) {
            <span class="keyword">return</span> <span class="literal">false</span>
        } <span class="keyword">else</span> <span class="keyword">if</span> (pox.y + y &gt;= gameData[<span class="number">0</span>].length) {
            <span class="keyword">return</span> <span class="literal">false</span>
        } <span class="keyword">else</span> <span class="keyword">if</span> (gameData[pox.x + x][pox.y + y] == <span class="number">1</span>) {
            <span class="keyword">return</span> <span class="literal">false</span>
        }
        <span class="keyword">return</span> <span class="literal">true</span>
    }
    <span class="comment">//监测数据是否合法</span>
    <span class="keyword">var</span> valid = <span class="function"><span class="keyword">function</span> (<span class="params">pos, data</span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (data[i][j] != <span class="number">0</span>) {
                    <span class="keyword">if</span> (!checkPonit(pos, i, j)) {
                        <span class="keyword">return</span> <span class="literal">false</span>;
                    }
                }
            }
        }
        <span class="keyword">return</span> <span class="literal">true</span>;
    }

    <span class="comment">//设置数据</span>
    <span class="keyword">var</span> setData = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cur.data.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; cur.data[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (checkPonit(cur.orgin, i, j)) {
                    gameData[i + cur.orgin.x][j + cur.orgin.y] = cur.data[i][j]
                    dataClass[i + cur.orgin.x][j + cur.orgin.y] = cur.class
                }
            }
        }
    }
    <span class="comment">//清除数据</span>
    <span class="keyword">var</span> clearData = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cur.data.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; cur.data[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (checkPonit(cur.orgin, i, j)) {
                    gameData[cur.orgin.x + i][cur.orgin.y + j] = <span class="number">0</span>
                    dataClass[i + cur.orgin.x][j + cur.orgin.y] = <span class="string">'none'</span>
                }
            }
        }
    }

    <span class="keyword">var</span> setTime = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
        <span class="keyword">if</span> (timeDiv) {
            timeDiv.innerText = data
        }
    }

    <span class="keyword">var</span> showGameOver = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        gameoverDiv.style.display = <span class="string">'block'</span>
    }

    <span class="keyword">var</span> clearGameOver = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        gameoverDiv.style.display = <span class="string">'none'</span>
    }

    <span class="comment">//初始化数据</span>
    <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params">dom, type, dir</span>) </span>{
        next = SquareFactory.prototype.make(type, dir)
        gameContainers = dom.gameContainers
        nextContainers = dom.nextContainers
        timeDiv = dom.timeDiv
        gameoverDiv = dom.gameoverDiv
        scoreDiv = dom.scoreDiv
        initDiv(gameData, gameContainers, gameDivs)
        initDiv(next.data, nextContainers, nextDivs)
        flushDiv(next.data, nextDivs, next.classData)
    }

    <span class="comment">//固定变色</span>
    <span class="keyword">var</span> fixed = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; gameData.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; gameData[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (checkPonit(cur.orgin, i, j)) {
                    <span class="keyword">if</span> (gameData[cur.orgin.x + i][cur.orgin.y + j] == <span class="number">2</span>) {
                        gameData[cur.orgin.x + i][cur.orgin.y + j] = <span class="number">1</span>
                    }
                }
            }
        }
        flushDiv(gameData, gameDivs, dataClass)
    }

    <span class="keyword">var</span> setScore = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
        <span class="keyword">if</span> (scoreDiv)
            scoreDiv.innerText = data
    }


    <span class="keyword">var</span> checkClear = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">var</span> lines = <span class="number">0</span>
        <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">data</span>) </span>{
            <span class="keyword">return</span> data == <span class="number">1</span>
        }
        <span class="keyword">for</span> (<span class="keyword">var</span> i = gameData.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {
            <span class="keyword">var</span> flag = gameData[i].every(check)

            <span class="keyword">if</span> (flag) {
                lines++
                <span class="keyword">for</span> (<span class="keyword">var</span> k = i; k &gt;= <span class="number">1</span>; k--) {
                    gameData[k] = (gameData[k - <span class="number">1</span>]).slice(<span class="number">0</span>)
                    dataClass[k] = (dataClass[k - <span class="number">1</span>]).slice(<span class="number">0</span>)
                }
                gameData[<span class="number">0</span>] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
                dataClass[<span class="number">0</span>] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
                i++
            }
        }
        <span class="keyword">return</span> lines

    }

    <span class="keyword">var</span> checkGameOver = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (gameData[<span class="number">0</span>][<span class="number">3</span>] == <span class="number">1</span> || gameData[<span class="number">0</span>][<span class="number">4</span>] == <span class="number">1</span> || gameData[<span class="number">0</span>][<span class="number">2</span>] == <span class="number">1</span> || gameData[<span class="number">0</span>][<span class="number">5</span>] == <span class="number">1</span>) {<span class="comment">//如果原点被占用</span>
            <span class="keyword">return</span> <span class="literal">true</span>
        }
        <span class="keyword">if</span> (!valid(next.orgin, next.data)) {
            <span class="keyword">return</span> <span class="literal">true</span>
        }


        <span class="keyword">return</span> <span class="literal">false</span>;
    }

    <span class="keyword">var</span> nextSquare = <span class="function"><span class="keyword">function</span> (<span class="params">type, dir</span>) </span>{
        cur = next
        setData()
        next = SquareFactory.prototype.make(type, dir)
        flushDiv(gameData, gameDivs, dataClass)
        initSquareClassData(next)
        flushDiv(next.data, nextDivs, next.classData)
    }

    <span class="keyword">var</span> initSquareClassData = <span class="function"><span class="keyword">function</span> (<span class="params">squ</span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; squ.data.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; squ.data[<span class="number">0</span>].length; j++) {
                <span class="keyword">if</span> (squ.data[i][j] != <span class="number">0</span>) {
                    squ.classData[i][j] = squ.class
                }
            }
        }
    }



    <span class="comment">//下移</span>
    <span class="keyword">var</span> down = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (cur.canDown(valid)) {
            clearData()
            cur.down()
            setData()
            flushDiv(gameData, gameDivs, dataClass)
            <span class="keyword">return</span> <span class="literal">true</span>
        }
        <span class="keyword">return</span> <span class="literal">false</span>
    }





    <span class="keyword">var</span> left = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (cur.canLeft(valid)) {
            clearData()
            cur.left()
            setData()
            flushDiv(gameData, gameDivs, dataClass)
        }
    }

    <span class="keyword">var</span> right = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (cur.canRight(valid)) {
            clearData()
            cur.right()
            setData()
            flushDiv(gameData, gameDivs, dataClass)
        }
    }

    <span class="keyword">var</span> rotate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (cur.canRotate(valid)) {
            clearData()
            cur.rotate()
            setData()
            flushDiv(gameData, gameDivs, dataClass)
        }
    }

    <span class="keyword">var</span> fall = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">while</span> (down()) { }
    }

    <span class="comment">//销毁的方法</span>
    <span class="keyword">var</span> destroyDiv = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; gameDivs.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; gameDivs[<span class="number">0</span>].length; j++) {
                gameContainers.removeChild(gameDivs[i][j])
            }
        }
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nextDivs.length; i++) {
            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; nextDivs[<span class="number">0</span>].length; j++) {
                nextContainers.removeChild(nextDivs[i][j])
            }
        }

    }

    <span class="keyword">this</span>.init = init
    <span class="keyword">this</span>.down = down
    <span class="keyword">this</span>.left = left
    <span class="keyword">this</span>.right = right
    <span class="keyword">this</span>.rotate = rotate
    <span class="keyword">this</span>.fall = fall
    <span class="keyword">this</span>.fixed = fixed
    <span class="keyword">this</span>.nextSquare = nextSquare
    <span class="keyword">this</span>.checkClear = checkClear
    <span class="keyword">this</span>.checkGameOver = checkGameOver
    <span class="keyword">this</span>.setTime = setTime
    <span class="keyword">this</span>.showGameOver = showGameOver
    <span class="keyword">this</span>.clearGameOver = clearGameOver
    <span class="keyword">this</span>.setScore = setScore
    <span class="keyword">this</span>.destroyDiv = destroyDiv

}
</code></pre>
<p>首先我先来讲一下这个游戏的原理，玩过俄罗斯方块的都清楚他的规则，我们的方块都在一个容器内，不能超出边界。是的，这个容器就是index.html中的<code>local_game</code>，这个容器的大小是400px<em>200px，我们定义一种小方块，每个大小为20px</em>20px，这个容器就能容纳10列*20行也就是200个小方块，现在这个容器被我们的小方块填充满了，游戏中我们所有的小方块有三种状态，1.空的小方块，也就是游戏中那些空闲的区域（白的区域）。2.固定的小方块，已经固定不能移动的小方块。3.正在动的小方块，也就是我门游戏中正在操作的小方块。我们给这三中状态定义假设一个值，比如：第一种状态为<code>0</code>，第二中状态为<code>1</code>，第三种状态为<code>2</code>。我们将这样200个小方块存在一个二维数组中（这里我们称之为dom数组），再将这200个小方块存入一个二维数组中（这里我们称之为状态数组）。当我们按上下左右移动方块时，其实就是更改状态数组，然后在根据状态数组的值改变dom数组中小方块的样式，比如：状态0显示白色，状态1显示蓝色，状态2显示粉色。到这里游戏的基本原理大概就解释完了，看懂了的话，下面的代码实现也就很好理解了。没看明白的话，可能..是我没说清楚吧（Σ( ° △ °|||)︴），那你可以根据源码实现一遍，应该也会理解的。</p>
<p>接下来讲解源码，由上至下开始讲，顶部的模块引入和一些变量生命先将它们忽略，后面用到的时候会提到，先说一些比较重要的变量，<code>gameData</code>就是我们上面提到的保存方块状态的二维数组，gameDivs是我们保存200个小方块的二维数组，还记得游戏上边有显示下一个方块的区域吧，这个区域我们的游戏区域显示远离一致，只是他比较小，大小只有80px*80px，他其中的16个小方块保存在<code>nexDivs</code>二维数组中。接下来的讲解中我们将200个的这种方块称为小方块，游戏中左右上下操作的方块称为下落的方块，以免大家混淆。 </p>
<pre><code class="javascript"><span class="comment">//初始化容器</span>
<span class="keyword">var</span> initDiv = <span class="function"><span class="keyword">function</span> (<span class="params">data, container, divs</span>) </span>{
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) {
        <span class="keyword">var</span> gameDiv = []
        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data[<span class="number">0</span>].length; j++) {
            <span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>)
            newNode.className = <span class="string">'none'</span>
            container.appendChild(newNode)
            gameDiv.push(newNode)
        }
        <span class="built_in">Array</span>.prototype.push.call(divs, gameDiv)
    }
}
<span class="comment">//刷新容器显示</span>
<span class="keyword">var</span> flushDiv = <span class="function"><span class="keyword">function</span> (<span class="params">data, divs, classes</span>) </span>{
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) {
        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data[<span class="number">0</span>].length; j++) {
            <span class="keyword">if</span> (data[i][j] == <span class="number">0</span>) {
                divs[i][j].className = <span class="string">'none'</span>
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (!classes[i][j])
                    classes[i][j] = <span class="string">'A'</span>
                divs[i][j].className = classes[i][j]
            }
        }
    }
}
</code></pre>
<p><code>initDiv</code>就是初始化容器的方法，他生成200个小方块设置样式为none并填充到容器中，因为容器和小方块的样式都是float:left,所以小方块能够顺序排列。<code>flushDiv</code>根据<code>gameData</code>中的数据变更小方块的样式。剩余的方法下面提及。接下里是下落的方块了。  </p>
<h4 id="square-js"><a href="#square-js" class="headerlink" title="square.js"></a>square.js</h4><pre><code class="javascript"><span class="keyword">var</span> Square = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">this</span>.data = [
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
    ]

    <span class="keyword">this</span>.classData = [
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
    ]
    <span class="keyword">this</span>.dir = <span class="number">0</span>

    <span class="keyword">this</span>.orgin = {
        x: <span class="number">0</span>,
        y: <span class="number">0</span>
    }
}

Square.prototype.canDown = <span class="function"><span class="keyword">function</span> (<span class="params">valid</span>) </span>{
    <span class="keyword">var</span> testDown = {
        x: <span class="keyword">this</span>.orgin.x + <span class="number">1</span>,
        y: <span class="keyword">this</span>.orgin.y,
    }
    <span class="keyword">return</span> valid(testDown, <span class="keyword">this</span>.data)
}

Square.prototype.canLeft = <span class="function"><span class="keyword">function</span> (<span class="params">valid</span>) </span>{
    <span class="keyword">var</span> testLeft = {
        x: <span class="keyword">this</span>.orgin.x,
        y: <span class="keyword">this</span>.orgin.y - <span class="number">1</span>,
    }
    <span class="keyword">return</span> valid(testLeft, <span class="keyword">this</span>.data)
}

Square.prototype.canRight = <span class="function"><span class="keyword">function</span> (<span class="params">valid</span>) </span>{
    <span class="keyword">var</span> testRight = {
        x: <span class="keyword">this</span>.orgin.x,
        y: <span class="keyword">this</span>.orgin.y + <span class="number">1</span>,
    }
    <span class="keyword">return</span> valid(testRight, <span class="keyword">this</span>.data)
}

Square.prototype.canRotate = <span class="function"><span class="keyword">function</span> (<span class="params">valid</span>) </span>{
    <span class="keyword">var</span> d = (<span class="keyword">this</span>.dir + <span class="number">1</span>) % <span class="number">4</span>
    <span class="keyword">return</span> valid(<span class="keyword">this</span>.orgin, <span class="keyword">this</span>.rotates[d])
}

Square.prototype.down = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">this</span>.orgin.x += <span class="number">1</span>
}

Square.prototype.left = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">this</span>.orgin.y -= <span class="number">1</span>
}

Square.prototype.right = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">this</span>.orgin.y += <span class="number">1</span>
}

Square.prototype.rotate = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>{
    <span class="keyword">if</span> (!num)
        num = <span class="number">1</span>
    <span class="keyword">this</span>.dir = (<span class="keyword">this</span>.dir + num) % <span class="number">4</span>
    <span class="keyword">this</span>.data = <span class="keyword">this</span>.rotates[<span class="keyword">this</span>.dir]
}
<span class="keyword">export</span> <span class="keyword">default</span> Square
</code></pre>
<p><code>Square</code>是所有下落方块的父类，<code>data</code>是描述方块形状的数组，此数组中只有状态3，因为他只表述运动中的方块，当方块固定下来后，这个方块回销毁，数据将存入game.js中的<code>gameData</code>，<code>orgin</code>是方块当前位置的原点，有了这个原点，移动方块时，只需要移动这个原点，这是一种很巧妙的思维方式，<code>dataClass</code>是保存运动中每个小方块样式的数组，每个下落的方块能翻转4次，<code>dir</code>是保存当前翻转形态的<code>down</code>,<code>right</code>,<code>left</code>是下落方块移动对应的方法，<code>rotate</code>是下落方块翻转的方法。对应的can方法是判断方块的位置是否能做对应的操作。    </p>
<h4 id="squareFactory-js"><a href="#squareFactory-js" class="headerlink" title="squareFactory.js"></a>squareFactory.js</h4><pre><code class="javascript"><span class="keyword">import</span> Square <span class="keyword">from</span> <span class="string">"./square.js"</span>;


<span class="keyword">var</span> prot = <span class="built_in">Object</span>.create(Square.prototype)

<span class="keyword">var</span> Square1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square1.prototype = prot

<span class="keyword">var</span> Square2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square2.prototype = prot

<span class="keyword">var</span> Square3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square3.prototype = prot


<span class="keyword">var</span> Square4 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square4.prototype = prot

<span class="keyword">var</span> Square5 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square5.prototype = prot

<span class="keyword">var</span> Square6 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square6.prototype = prot

<span class="keyword">var</span> Square7 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{

    Square.call(<span class="keyword">this</span>)

    <span class="keyword">this</span>.rotates = [
        [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ], [
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],
            [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]
        ]
    ]
}
Square7.prototype = prot


<span class="keyword">var</span> SquareFactory = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{ }

SquareFactory.prototype.make = <span class="function"><span class="keyword">function</span> (<span class="params">index, dir</span>) </span>{
    <span class="keyword">var</span> classes = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>]
    <span class="keyword">var</span> s
    index += <span class="number">1</span>
    <span class="keyword">switch</span> (index) {
        <span class="keyword">case</span> <span class="number">1</span>:
            s = <span class="keyword">new</span> Square1()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">2</span>:
            s = <span class="keyword">new</span> Square2()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">3</span>:
            s = <span class="keyword">new</span> Square3()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">4</span>:
            s = <span class="keyword">new</span> Square4()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">5</span>:
            s = <span class="keyword">new</span> Square5()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">6</span>:
            s = <span class="keyword">new</span> Square6()
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="number">7</span>:
            s = <span class="keyword">new</span> Square7()
            <span class="keyword">break</span>;
    }



    s.orgin.x = <span class="number">0</span>
    s.orgin.y = <span class="number">3</span>
    s.class = classes[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">9</span>) - <span class="number">1</span>]

    s.rotate(dir)

    <span class="keyword">return</span> s;
}

<span class="keyword">export</span> <span class="keyword">default</span> SquareFactory
</code></pre>
<p>看<code>squareFactory</code>这个名字大家都会明白这是个工厂模块，不明白工厂模式的请自行百度… 在<code>squareFactory</code>中定义了俄罗斯方块中基本的七种方块，并提供了生成方块的方法，这七中方块都继承自<code>square</code>，也就是它们都有移动的方法，不同于父模块，这些方块中的<code>rotates</code>定义了此方块翻转的四种形态。<code>squareFactory</code>的<code>make</code>方法根据参数生成方块，<code>index</code>参数代表要生成的方块，<code>dir</code>表示方块翻转的形态，这两个参数将由game模块传进来，当然这两个方块是随机数，因为每次的方块都是随机的。<code>classes</code>表示的是方块的样式，初始将会给方块也随机赋予一个颜色。  </p>
<h4 id="local-js"><a href="#local-js" class="headerlink" title="local.js"></a>local.js</h4><pre><code class="javascript"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span>;
<span class="keyword">import</span> Game <span class="keyword">from</span> <span class="string">"./game.js"</span>;
<span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
    <span class="keyword">var</span> game

    <span class="keyword">var</span> timer
    <span class="keyword">var</span> INTERVAL = <span class="number">200</span>
    <span class="keyword">var</span> hours
    <span class="keyword">var</span> minute
    <span class="keyword">var</span> seconds

    <span class="keyword">var</span> score = <span class="number">0</span>

    <span class="keyword">var</span> timeCount = <span class="number">0</span>

    <span class="keyword">var</span> isStart = <span class="literal">false</span>;
    <span class="keyword">var</span> isPause = <span class="literal">false</span>

    <span class="keyword">var</span> bindKeyEvent = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="built_in">document</span>.onkeydown = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{
            <span class="keyword">switch</span> (e.keyCode) {
                <span class="keyword">case</span> <span class="number">38</span>:<span class="comment">//up</span>
                    game.rotate()
                    <span class="keyword">break</span>
                <span class="keyword">case</span> <span class="number">39</span>:<span class="comment">//right</span>
                    game.right()
                    <span class="keyword">break</span>
                <span class="keyword">case</span> <span class="number">37</span>:<span class="comment">//left</span>
                    game.left()
                    <span class="keyword">break</span>
                <span class="keyword">case</span> <span class="number">40</span>:<span class="comment">//down</span>
                    game.down()
                    <span class="keyword">break</span>
                <span class="keyword">case</span> <span class="number">32</span>:<span class="comment">//space</span>
                    game.fall()
                    <span class="keyword">break</span>
            }
        }
    }

    <span class="keyword">var</span> generateType = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">7</span>) - <span class="number">1</span>
    }

    <span class="keyword">var</span> generateDir = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">4</span>) - <span class="number">1</span>
    }

    <span class="keyword">var</span> addScore = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
        <span class="keyword">switch</span> (data) {
            <span class="keyword">case</span> <span class="number">0</span>:
                <span class="keyword">return</span> <span class="number">0</span>
            <span class="keyword">case</span> <span class="number">1</span>:
                <span class="keyword">return</span> <span class="number">10</span>
            <span class="keyword">case</span> <span class="number">2</span>:
                <span class="keyword">return</span> <span class="number">40</span>
            <span class="keyword">case</span> <span class="number">3</span>:
                <span class="keyword">return</span> <span class="number">60</span>
            <span class="keyword">case</span> <span class="number">4</span>:
                <span class="keyword">return</span> <span class="number">80</span>
            <span class="keyword">default</span>:
                <span class="keyword">return</span> <span class="number">100</span>
        }
    }


    <span class="keyword">var</span> gameOver = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        clearInterval(timer)
        game.showGameOver()
        game.nextSquare(generateType(), generateDir())
        <span class="built_in">document</span>.onkeydown = <span class="literal">null</span>
        timer = <span class="literal">null</span>
        timeCount = <span class="number">0</span>
        score = <span class="number">0</span> 
        isStart = <span class="literal">true</span>
    }

    <span class="keyword">var</span> clearGameOver = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        game.clearGameOver()
        game.destroyDiv()
        game.setScore(<span class="number">0</span>)
        game.setTime(<span class="number">0</span>)
    }

    <span class="keyword">var</span> move = <span class="function"><span class="keyword">function</span> (<span class="params">gamoverDiv</span>) </span>{
        <span class="keyword">if</span> (!game.down()) {<span class="comment">//如果不能下落</span>
            game.fixed()<span class="comment">//固定</span>
            score += addScore(game.checkClear())
            game.setScore(score)<span class="comment">//消行</span>
            <span class="keyword">if</span> (game.checkGameOver()) {<span class="comment">//判断游戏是否结束</span>
                gameOver()
            } <span class="keyword">else</span> {
                game.nextSquare(generateType(), generateDir())<span class="comment">//生成下一个方块</span>
            }
        }
    }

    <span class="keyword">var</span> addTime = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        timeCount++;
        <span class="keyword">if</span> (timeCount % <span class="number">5</span> == <span class="number">0</span>) {
            seconds = timeCount / <span class="number">5</span>
            <span class="keyword">var</span> showTime;
            <span class="keyword">if</span> (seconds &gt;= <span class="number">3600</span>) {
                <span class="keyword">var</span> tmp = seconds % <span class="number">3600</span>
                <span class="keyword">var</span> tmpMinute = <span class="built_in">Math</span>.floor(tmp / <span class="number">60</span>)
                showTime = <span class="built_in">Math</span>.floor(seconds / <span class="number">3600</span>) + <span class="string">"小时"</span> + tmpMinute + <span class="string">'分'</span> + tmp % <span class="number">60</span> + <span class="string">'秒'</span>
            } <span class="keyword">else</span> <span class="keyword">if</span> (seconds &gt;= <span class="number">60</span>) {
                showTime = <span class="built_in">Math</span>.floor(seconds / <span class="number">60</span>) + <span class="string">"分"</span> + seconds % <span class="number">60</span> + <span class="string">'秒'</span>
            } <span class="keyword">else</span> {
                showTime = seconds + <span class="string">'秒'</span>
            }
            game.setTime(showTime)
        }
    }

    <span class="keyword">var</span> start = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (!timer) {
            <span class="keyword">if</span>(isStart)
                clearGameOver()
            game = <span class="keyword">new</span> Game()
            <span class="keyword">var</span> doms = {
                gameContainers: <span class="built_in">document</span>.getElementById(<span class="string">"local_game"</span>),
                nextContainers: <span class="built_in">document</span>.getElementById(<span class="string">"local_next"</span>),
                timeDiv: <span class="built_in">document</span>.getElementById(<span class="string">"local_time"</span>),
                gameoverDiv: <span class="built_in">document</span>.getElementById(<span class="string">"local_gameover"</span>),
                scoreDiv: <span class="built_in">document</span>.getElementById(<span class="string">"local_score"</span>)
            }

            game.init(doms, generateType(), generateDir())
            game.nextSquare(generateType(), generateDir())
            bindKeyEvent()

            timer = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
                move()
                addTime()
            }, INTERVAL)
        }
    }

    <span class="keyword">var</span> pause = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{
        <span class="keyword">if</span> (!isPause &amp;&amp; timer) {
            isPause = <span class="literal">true</span>
            clearInterval(timer)
            <span class="keyword">this</span>.innerText = <span class="string">'继续'</span>
            <span class="keyword">this</span>.onclick = continue_
            <span class="built_in">document</span>.onkeydown = <span class="literal">null</span>
        }
    }

    <span class="keyword">var</span> continue_ = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="keyword">if</span> (isPause) {
            isPause = <span class="literal">false</span>
            timer = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
                move()
                addTime()
            }, INTERVAL)
            <span class="keyword">this</span>.innerText = <span class="string">'暂停'</span>
            <span class="keyword">this</span>.onclick = pause
            bindKeyEvent()
        }
    }

    <span class="keyword">var</span> stop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        isStart = <span class="literal">false</span>
        clearInterval(timer)
        <span class="built_in">document</span>.onkeydown = <span class="literal">null</span>
        timer = <span class="literal">null</span>
        game.destroyDiv()
        game.clearGameOver()
        game.setScore(<span class="number">0</span>)
        game.setTime(<span class="number">0</span>)
        timeCount = <span class="number">0</span>
        score = <span class="number">0</span>
    }

    <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
        <span class="comment">//绑定开始按钮事件</span>
        <span class="built_in">document</span>.getElementById(<span class="string">"local_start"</span>).onclick = start
        <span class="comment">//绑定暂停按钮事件</span>
        <span class="built_in">document</span>.getElementById(<span class="string">"local_pause"</span>).onclick = pause
        <span class="comment">//绑定结束按钮事件</span>
        <span class="built_in">document</span>.getElementById(<span class="string">"local_stop"</span>).onclick = stop
    }




    <span class="keyword">this</span>.init = init

}
</code></pre>
<p><code>local</code>模块主要是开始，暂停，继续，结束按钮事件和上下左右空格键盘输入事件以及判断游戏结束的。这块不是我们的重点环节，注释都有，大家自行食用吧。</p>
<h3 id="总体描述"><a href="#总体描述" class="headerlink" title="总体描述"></a>总体描述</h3><p>我们的游戏代码其实就是主页加载<code>local</code>,<code>loacl</code>绑定键盘和按钮事件，事件中调用<code>game</code>,<code>game</code>再调用<code>squareFactory</code>生成下落方块，当我们输入操作时，再通过<code>Square</code>中对应的方法修改下落方块的<code>data</code>数组和<code>orgin</code>原点，<code>game</code>再通过原点和<code>data</code>修改自己的<code>gameData</code>，接着再通过<code>gameData</code>数组来刷新<code>gameDivs</code>和<code>nextDivs</code>中小方块的样式。<br>由于代码细节较多，如方块消行，加分，判断点位置合法性，判断游戏结束等等，我也不可能一一列出啦，所以这些细节大家如果感兴趣的话可以到<a href="https://github.com/yeqingyun/Square" target="_blank" rel="external">源码</a>中去查看。怎么样，明白了吗？有什么问题请下方留言。</p>

      


    
      <div>
        <div class="my_post_copyright">
          <p><span>本文标题:</span><a href="/posts/4a17a002/">用javascript开发一个俄罗斯方块</a></p>
          <p><span>文章作者:</span><a href="/" title="叶青云的个人博客">叶青云</a></p>
          <p><span>发布时间:</span>2016年1月9日 13:36</p>
          <p><span>最后更新:</span>2016年1月9日 13:36</p>
          <p>
            <span>原始链接:</span>
            <a href="/posts/4a17a002/" title="用javascript开发一个俄罗斯方块">http://ilovejava.cn/posts/4a17a002/</a>
          </p>
          <p>
            <span>许可协议:</span>
            <i class="fa fa-creative-commons"></i> 
            <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>
        </div>
      </div>
    

    
      <div>
        <div class="reward-container">
          <a id="rewardButton" href="javascript:void(0)">
            <span class="reward-span">赏</span>
          </a>
          <div id="pay" class="reward-img-container">
            <div id="alipay" class="reward">
              <img id="alipay_qr" class="reward-img" src="/gallery/pay.png">
              <p>听说帅的人都已经打赏了(又支持微信又支持支付宝哟)</p>
            </div>
          </div>
        </div>
      </div>
    

    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/游戏/">游戏</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/posts/4a17a003/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          最最常用的git command
        
      </div>
    </a>
  
  
</nav>

  
</article>



  <!-- Table of Contents -->
  
    <aside id="sidebar">
      <div id="toc" class="toc-article">
      <strong class="toc-title">文章目录</strong>
      
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#开发环境"><span class="nav-number">1.</span> <span class="nav-text">开发环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码"><span class="nav-number">2.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在线演示"><span class="nav-number">3.</span> <span class="nav-text">在线演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码分析"><span class="nav-number">4.</span> <span class="nav-text">源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#index-html"><span class="nav-number">4.1.</span> <span class="nav-text">index.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#game-js"><span class="nav-number">4.2.</span> <span class="nav-text">game.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#square-js"><span class="nav-number">4.3.</span> <span class="nav-text">square.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#squareFactory-js"><span class="nav-number">4.4.</span> <span class="nav-text">squareFactory.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#local-js"><span class="nav-number">4.5.</span> <span class="nav-text">local.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总体描述"><span class="nav-number">5.</span> <span class="nav-text">总体描述</span></a></li></ol>
      
      </div>
    </aside>
  




<script>
  (function(){
      var bp = document.createElement('script');
      bp.src = '//push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>     
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 一些 All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
        
        
          Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
        
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="/js/mathjax.js">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>
<script src="/js/nprogress.js"></script>
<script type="text/javascript">
NProgress.start();
document.onreadystatechange = nprogressLoad;//当页面加载状态改变的时候执行这个方法. 
let progressInterval;
function nprogressLoad() 
{ 
  if(document.readyState == "complete"){ //当页面加载状态 
     NProgress.done();
     clearInterval(progressInterval)
  }else{
    progressInterval = setInterval(function(){
      NProgress.inc()
    },600)  
  }
} 
  
</script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
